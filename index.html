<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Roulette Pro - Logic Verified</title>
    <style>
        body { background: #004d26; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; }
        .dashboard { background: #1a1a1a; padding: 15px; border-radius: 8px; border: 2px solid gold; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 10px; width: 95%; max-width: 900px; justify-content: space-around; }
        .balance-box { font-size: 22px; font-weight: bold; color: #00ff00; }
        .info-label { font-size: 11px; color: gold; text-transform: uppercase; display: block; }
        .tavolo { display: grid; grid-template-columns: 45px repeat(12, 35px); grid-template-rows: repeat(3, 35px); gap: 1px; background: #fff; border: 1px solid gold; }
        .cell { background: #006633; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; border: 1px solid #005522; font-size: 14px; }
        .zero-main { grid-row: 1 / span 3; background: #28a745; }
        .red { background: #e61919; } .black { background: #1a1a1a; }
        #history { width: 95%; max-width: 900px; min-height: 25px; background: #000; margin: 10px 0; display: flex; align-items: center; padding: 5px 10px; color: gold; border: 1px solid #bc9a5b; font-size: 12px; }
        .racetrack { display: grid; grid-template-columns: 40px repeat(15, 40px) 40px; grid-template-rows: repeat(6, 40px); gap: 1px; background: #111; padding: 10px; border: 2px solid #444; }
        .slot { border: 1px solid #555; display: flex; flex-direction: column; background: #222; }
        .val { height: 16px; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        .num { flex-grow: 1; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
        .slot-zero { grid-row: span 2; }
        .predicted { outline: 2px solid #00ff00; z-index: 10; box-shadow: 0 0 8px #00ff00; }
        .bet-box { background: rgba(0,0,0,0.7); border: 1px solid gold; padding: 10px; border-radius: 6px; width: 45%; }
        .list-nums { color: #00ff00; font-size: 18px; font-weight: bold; }
        .new-nums { color: #ffeb3b; font-size: 18px; font-weight: bold; }
        .win-alert { position: fixed; top: 20%; background: gold; color: black; padding: 10px 30px; font-size: 24px; font-weight: bold; border-radius: 5px; display: none; z-index: 100; }
    </style>
</head>
<body>

    <div id="win-msg" class="win-alert">VINCITA! ðŸ’°</div>

    <div class="dashboard">
        <div class="balance-box"><span class="info-label">Saldo</span><span id="balance">100.00</span>â‚¬</div>
        <div><span class="info-label">Fiche</span><select id="chip-val"><option value="0.10">0.10â‚¬</option><option value="0.50">0.50â‚¬</option><option value="1.00">1.00â‚¬</option></select></div>
        <div><span class="info-label">ModalitÃ </span><select id="mode-select" onchange="resetSession()"><option value="alt">Alternata (OR/ANT)</option><option value="ccw">Solo Antiorario</option><option value="cw">Solo Orario</option></select></div>
        <button onclick="resetSession()">RESET</button>
    </div>

    <div class="tavolo" id="tavolo-ui"><div class="cell zero-main" onclick="addNum(0)">0</div></div>
    <div id="history">Storico: -</div>
    <div class="racetrack" id="ruota-ui"></div>

    <div style="width:95%; max-width:900px; display:flex; justify-content:space-between;">
        <div class="bet-box"><span class="info-label">Nuovi da aggiungere</span><div id="new-bet-nums" class="new-nums">-</div></div>
        <div class="bet-box"><span class="info-label">Totale in gioco</span><div id="total-bet-nums" class="list-nums">-</div></div>
    </div>

<script>
    const wheel = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    const reds = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
    let state = { balance: 100.00, history: [], distCW: [], distCCW: [], totalClicks: 0, currentBets: [] };

    // Costruzione Tavolo
    const tUi = document.getElementById('tavolo-ui');
    for(let c=1; c<=12; c++) { for(let r=3; r>=1; r--) {
        let n = (c-1)*3+r; let d = document.createElement('div');
        d.className=`cell ${reds.includes(n)?'red':'black'}`; d.style.gridColumn=c+1; d.style.gridRow=4-r;
        d.innerText=n; d.onclick=()=>addNum(n); tUi.appendChild(d);
    }}

    function buildWheel() {
        const ruotaDiv = document.getElementById('ruota-ui'); ruotaDiv.innerHTML = '';
        const path = [
            {n: 5, r: 1, c: 2}, {n: 24, r: 1, c: 3}, {n: 16, r: 1, c: 4}, {n: 33, r: 1, c: 5}, {n: 1, r: 1, c: 6}, {n: 20, r: 1, c: 7}, {n: 14, r: 1, c: 8}, {n: 31, r: 1, c: 9}, {n: 9, r: 1, c: 10}, {n: 22, r: 1, c: 11}, {n: 18, r: 1, c: 12}, {n: 29, r: 1, c: 13}, {n: 7, r: 1, c: 14}, {n: 28, r: 1, c: 15}, {n: 12, r: 1, c: 16},
            {n: 35, r: 2, c: 17}, {n: 3, r: 3, c: 17}, {n: 26, r: 4, c: 17}, {n: 0, r: 5, c: 17, special: 'zero'},
            {n: 32, r: 6, c: 16}, {n: 15, r: 6, c: 15}, {n: 19, r: 6, c: 14}, {n: 4, r: 6, c: 13}, {n: 21, r: 6, c: 12}, {n: 2, r: 6, c: 11}, {n: 25, r: 6, c: 10}, {n: 17, r: 6, c: 9}, {n: 34, r: 6, c: 8}, {n: 6, r: 6, c: 7}, {n: 27, r: 6, c: 6}, {n: 13, r: 6, c: 5}, {n: 36, r: 6, c: 4}, {n: 11, r: 6, c: 3}, {n: 30, r: 6, c: 2},
            {n: 8, r: 5, c: 1}, {n: 23, r: 4, c: 1}, {n: 10, r: 3, c: 1}
        ];
        path.forEach(item => {
            let s = document.createElement('div'); s.className = 'slot' + (item.special==='zero'?' slot-zero':'');
            s.id = `s-${item.n}`; s.style.gridRow = `${item.r} / span ${item.special==='zero'?2:1}`; s.style.gridColumn = item.c;
            s.innerHTML = `<div class="val h0" id="v-${item.n}">0</div><div class="num" style="background:${item.n===0?'#28a745':reds.includes(item.n)?'#e61919':'#1a1a1a'}">${item.n}</div>`;
            ruotaDiv.appendChild(s);
        });
    }

    function addNum(n) {
        const mode = document.getElementById('mode-select').value;
        const chip = parseFloat(document.getElementById('chip-val').value);
        
        // 1. Verifica Vincita
        if (state.currentBets.includes(n)) {
            state.balance += (chip * 36);
            state.currentBets = [];
            document.getElementById('win-msg').style.display = 'block';
            setTimeout(()=>document.getElementById('win-msg').style.display='none', 2000);
        }

        // 2. Sottrazione costo
        if (state.currentBets.length > 0) state.balance -= (state.currentBets.length * chip);

        // 3. Calcolo Distanze (LOGICA VERIFICATA)
        if (state.history.length > 0) {
            let last = state.history[state.history.length-1];
            let iL = wheel.indexOf(last), iN = wheel.indexOf(n);
            
            let dCW = (iN - iL + 37) % 37; // Passi orari per arrivare a N
            let dCCW = (iL - iN + 37) % 37; // Passi antiorari per arrivare a N

            if (mode === 'cw') state.distCW.push(dCW);
            else if (mode === 'ccw') state.distCCW.push(dCCW);
            else {
                // Alternata: il lancio appena avvenuto (totalClicks 1->2, 3->4...) Ã¨ ORARIO
                // (Se totalClicks Ã¨ pari, abbiamo appena inserito un numero dispari -> orario)
                (state.totalClicks % 2 === 0) ? state.distCW.push(dCW) : state.distCCW.push(dCCW);
            }
            if(state.distCW.length > 10) state.distCW.shift();
            if(state.distCCW.length > 10) state.distCCW.shift();
        }

        state.history.push(n); state.totalClicks++;
        if (state.history.length > 20) state.history.shift();
        updateUI(); saveStorage();
    }

    function updateUI() {
        const mode = document.getElementById('mode-select').value;
        document.getElementById('balance').innerText = state.balance.toFixed(2);
        document.getElementById('history').innerText = "Storico: " + state.history.join(" - ");

        // Reset Racetrack
        let counts = {}; wheel.forEach(n => { 
            counts[n]=0; document.getElementById(`v-${n}`).innerText="0"; 
            document.getElementById(`v-${n}`).className="val h0";
            document.getElementById(`s-${n}`).classList.remove('predicted');
        });

        if (state.history.length === 0) return;
        
        let lastN = state.history[state.history.length-1];
        let lastI = wheel.indexOf(lastN);

        // Determinazione Verso PROSSIMO Lancio
        let nextIsCW = (mode === 'cw' || (mode === 'alt' && state.totalClicks % 2 === 0));
        let activeDists = nextIsCW ? state.distCW : state.distCCW;

        // Applicazione distanze (LOGICA VERIFICATA)
        activeDists.forEach(d => {
            let targetI = nextIsCW ? (lastI + d) % 37 : (lastI - d + 37) % 37;
            let targetN = wheel[targetI];
            counts[targetN]++;
        });

        let suggested = [];
        wheel.forEach(n => {
            if(counts[n] > 0) {
                let v = document.getElementById(`v-${n}`);
                v.innerText = counts[n]; v.className = "val h" + Math.min(counts[n], 3);
                document.getElementById(`s-${n}`).classList.add('predicted');
                
                // Criteri: Ripetizione > 1 o Vicini contigui
                let i = wheel.indexOf(n);
                if(counts[n] > 1 || counts[wheel[(i-1+37)%37]] > 0 || counts[wheel[(i+1)%37]] > 0) suggested.push(n);
            }
        });

        if (state.history.length >= 10) {
            let newOnes = suggested.filter(n => !state.currentBets.includes(n)).sort((a,b)=>a-b);
            document.getElementById('new-bet-nums').innerText = newOnes.length > 0 ? newOnes.join(", ") : "-";
            state.currentBets = Array.from(new Set([...state.currentBets, ...suggested])).sort((a,b)=>a-b);
            document.getElementById('total-bet-nums').innerText = state.currentBets.join(", ");
        } else {
            document.getElementById('total-bet-nums').innerText = "Attesa 10 lanci...";
        }
    }

    function saveStorage() { localStorage.setItem('rouletteFinalSafe', JSON.stringify(state)); }
    function loadStorage() {
        const s = localStorage.getItem('rouletteFinalSafe');
        if(s) { state = JSON.parse(s); buildWheel(); updateUI(); } else buildWheel();
    }
    function resetSession() {
        if(confirm("Resettare?")) {
            localStorage.removeItem('rouletteFinalSafe');
            state = { balance: 100.0, history: [], distCW: [], distCCW: [], totalClicks: 0, currentBets: [] };
            buildWheel(); updateUI();
        }
    }
    loadStorage();
</script>
</body>
</html>
